<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>物聯網控制開門</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
</head>
<body>
    <button class="door" id="door">
        <img src="" alt="">
        <label class="openDoor" for="">
            開門  
        </label>
    </button>

    <script>
        var hostname = "192.168.50.166"
        var port = "8080"

        var connected = false;
        var client = new Paho.MQTT.Client(hostname, Number(port),"");

        client.startTrace();

        var options = {
            invocationContext: { host: hostname, port:port, clientId: "" },
            timeout: 5,
            keepAliveInterval: 60,
            cleanSession: true,
            useSSL: false ,
            //reconnect: true,
            onSuccess: onConnect,
            onFailure: onFail,
            mqttVersion: 4
        };

        client.connect(options)

        client.onConnected = onConnected
        client.onMessageArrived = onMessageArrived
        client.onConnectionLost = onConnectionLost

        function onConnect(context) {
            // Once a connection has been made, make a subscription and send a message.
            var connectionString = context.invocationContext.host + ":" + context.invocationContext.port + context.invocationContext.path;
            
            connected = true;

        }

        function onFail(context) {
            connected = false;

        }

        function onConnected(reconnect, uri) {
            // Once a connection has been made, make a subscription and send a message.
            connected = true;

        }

        function onMessageArrived(message) {

        }

        function onConnectionLost(responseObject) {
            connected = false;
        }

        document.getElementById("door").onclick = function(){
            message = new Paho.MQTT.Message("1");
            message.destinationName = "tcivs/box/door"
            message.qos = 0;
            message.retain = false;
            client.send(message)
        }
    </script>
</body>
</html>
